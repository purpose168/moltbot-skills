---
name: 3d
description: 在 Remotion 中使用 Three.js 和 React Three Fiber 创建 3D 内容。
metadata:
  tags: 3d, three, threejs
---

# 在 Remotion 中使用 Three.js 和 React Three Fiber

遵循 React Three Fiber 和 Three.js 的最佳实践。
只需要遵守以下 Remotion 特定规则：

## 前置条件

首先，需要安装 `@remotion/three` 包。
如果尚未安装，请使用以下命令：

```bash
npx remotion add @remotion/three # 如果项目使用 npm
bunx remotion add @remotion/three # 如果项目使用 bun
yarn remotion add @remotion/three # 如果项目使用 yarn
pnpm exec remotion add @remotion/three # 如果项目使用 pnpm
```

## 使用 ThreeCanvas

您必须将 3D 内容包装在 `<ThreeCanvas>` 中，并包含适当的光源。
`<ThreeCanvas>` 必须具有 `width` 和 `height` 属性。

```tsx
import { ThreeCanvas } from "@remotion/three";
import { useVideoConfig } from "remotion";

const { width, height } = useVideoConfig();

<ThreeCanvas width={width} height={height}>
  {/* 环境光：提供基础照明，强度 0.4 */}
  <ambientLight intensity={0.4} />
  {/* 方向光：模拟太阳光，从右上方照射 */}
  <directionalLight position={[5, 5, 5]} intensity={0.8} />
  {/* 3D 网格：创建一个球体 */}
  <mesh>
    {/* 球体几何体：半径 1，分段数 32x32 */}
    <sphereGeometry args={[1, 32, 32]} />
    {/* 标准材质：红色 */}
    <meshStandardMaterial color="red" />
  </mesh>
</ThreeCanvas>
```

## 禁止不使用 `useCurrentFrame()` 驱动的动画

着色器、模型等不能自行动画化。
除非动画由 `useCurrentFrame()` 驱动，否则不允许使用动画。
否则，会导致渲染时出现闪烁。

禁止使用 `@react-three/fiber` 的 `useFrame()`。

## 使用 `useCurrentFrame()` 进行动画

使用 `useCurrentFrame()` 执行动画。

```tsx
const frame = useCurrentFrame(); // 获取当前帧号
const rotationY = frame * 0.02; // 根据帧号计算 Y 轴旋转角度

{/* 旋转网格：围绕 Y 轴旋转 */}
<mesh rotation={[0, rotationY, 0]}>
  {/* 立方体几何体：2x2x2 大小 */}
  <boxGeometry args={[2, 2, 2]} />
  {/* 蓝色标准材质 */}
  <meshStandardMaterial color="#4a9eff" />
</mesh>
```

## 在 `<ThreeCanvas>` 内使用 `<Sequence>`

`<ThreeCanvas>` 内任何 `<Sequence>` 的 `layout` 属性必须设置为 `none`。

```tsx
import { Sequence } from "remotion";
import { ThreeCanvas } from "@remotion/three";

const { width, height } = useVideoConfig();

<ThreeCanvas width={width} height={height}>
  {/* Sequence 布局设置为 none，避免与 ThreeCanvas 布局冲突 */}
  <Sequence layout="none">
    <mesh>
      <boxGeometry args={[2, 2, 2]} />
      <meshStandardMaterial color="#4a9eff" />
    </mesh>
  </Sequence>
</ThreeCanvas>
```
