---
name: claude-code-usage
description: æ£€æŸ¥ Claude Code OAuth ä½¿ç”¨é™åˆ¶ï¼ˆä¼šè¯å’Œæ¯å‘¨é…é¢ï¼‰ã€‚å½“ç”¨æˆ·è¯¢é—® Claude Code ä½¿ç”¨æƒ…å†µã€å‰©ä½™é™åˆ¶ã€é€ŸçŽ‡é™åˆ¶æˆ–å‰©ä½™ä½¿ç”¨é‡æ—¶ä½¿ç”¨ã€‚åŒ…æ‹¬è‡ªåŠ¨ä¼šè¯åˆ·æ–°æé†’å’Œé‡ç½®æ£€æµ‹ç›‘æŽ§ã€‚
metadata:
  clawdbot:
    emoji: "ðŸ“Š"
    os:
      - darwin
      - linux
    requires:
      bins:
        - curl
---

# Claude Code ä½¿ç”¨æƒ…å†µæ£€æŸ¥

æ£€æŸ¥æ‚¨çš„ Claude Code OAuth API ä½¿ç”¨é™åˆ¶ï¼ŒåŒ…æ‹¬ä¼šè¯ï¼ˆ5å°æ—¶ï¼‰å’Œæ¯å‘¨ï¼ˆ7å¤©ï¼‰çª—å£ã€‚

## å¿«é€Ÿå¼€å§‹

```bash
cd {baseDir}
./scripts/claude-usage.sh
```

## ä½¿ç”¨æ–¹æ³•

```bash
# é»˜è®¤ï¼šæ˜¾ç¤ºç¼“å­˜çš„ä½¿ç”¨æƒ…å†µï¼ˆå¦‚æžœæ–°é²œï¼‰
./scripts/claude-usage.sh

# å¼ºåˆ¶ä»Ž API åˆ·æ–°
./scripts/claude-usage.sh --fresh

# JSON è¾“å‡º
./scripts/claude-usage.sh --json

# è‡ªå®šä¹‰ç¼“å­˜ TTL
./scripts/claude-usage.sh --cache-ttl 300
```

## è¾“å‡ºæ ¼å¼

**æ–‡æœ¬æ ¼å¼**ï¼ˆé»˜è®¤ï¼‰ï¼š
```
ðŸ¦ž Claude Code ä½¿ç”¨æƒ…å†µ

â±ï¸  ä¼šè¯ (5h): ðŸŸ¢ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 40%
   é‡ç½®æ—¶é—´: 2å°æ—¶ 15åˆ†é’Ÿ

ðŸ“… æ¯å‘¨ (7d): ðŸŸ¡ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 60%
   é‡ç½®æ—¶é—´: 3å¤© 8å°æ—¶
```

**JSON æ ¼å¼** (`--json`)ï¼š
```json
{
  "session": {
    "utilization": 40,
    "resets_in": "2h 15m",
    "resets_at": "2026-01-19T22:15:00Z"
  },
  "weekly": {
    "utilization": 60,
    "resets_in": "3d 8h",
    "resets_at": "2026-01-22T04:00:00Z"
  },
  "cached_at": "2026-01-19T20:00:00Z"
}
```

## åŠŸèƒ½ç‰¹æ€§

- ðŸ“Š **ä¼šè¯é™åˆ¶**ï¼ˆ5å°æ—¶çª—å£ï¼‰- çŸ­æœŸé€ŸçŽ‡é™åˆ¶
- ðŸ“… **æ¯å‘¨é™åˆ¶**ï¼ˆ7å¤©çª—å£ï¼‰- é•¿æœŸé€ŸçŽ‡é™åˆ¶
- âš¡ **æ™ºèƒ½ç¼“å­˜** - 60ç§’ç¼“å­˜é¿å… API è¯·æ±‚è¿‡å¤š
- ðŸŽ¨ **ç¾Žè§‚è¾“å‡º** - è¿›åº¦æ¡ã€Emojiã€é¢œè‰²ç¼–ç çŠ¶æ€
- ðŸ”„ **å¼ºåˆ¶åˆ·æ–°** - ä½¿ç”¨ `--fresh` æ ‡å¿—ç»•è¿‡ç¼“å­˜
- ðŸ“¤ **JSON è¾“å‡º** - æœºå™¨å¯è¯»æ ¼å¼
- ðŸ”” **è‡ªåŠ¨åŒ–ç›‘æŽ§** - é…é¢é‡ç½®æ—¶èŽ·å–é€šçŸ¥

## çŠ¶æ€æŒ‡ç¤ºå™¨

- ðŸŸ¢ **ç»¿è‰²** - 0-50% ä½¿ç”¨é‡ï¼ˆå¥åº·ï¼‰
- ðŸŸ¡ **é»„è‰²** - 51-80% ä½¿ç”¨é‡ï¼ˆä¸­ç­‰ï¼‰
- ðŸ”´ **çº¢è‰²** - 81-100% ä½¿ç”¨é‡ï¼ˆé«˜/ä¸¥é‡ï¼‰

## ç³»ç»Ÿè¦æ±‚

- **macOS**ï¼šä½¿ç”¨é’¥åŒ™ä¸²è®¿é—® Claude Code å‡­æ®
- **Linux**ï¼šä½¿ç”¨ `secret-tool` å­˜å‚¨å‡­æ®
- **å‡­æ®**ï¼šå¿…é¡»å·²å®‰è£…å¹¶éªŒè¯ Claude Code CLI

## å·¥ä½œåŽŸç†

1. ä»Žç³»ç»Ÿé’¥åŒ™ä¸²æ£€ç´¢ OAuth ä»¤ç‰Œ
2. ä½¿ç”¨ OAuth bearer ä»¤ç‰ŒæŸ¥è¯¢ `api.anthropic.com/api/oauth/usage`
3. è§£æž `five_hour` å’Œ `seven_day` åˆ©ç”¨çŽ‡æŒ‡æ ‡
4. è®¡ç®—è·ç¦»é‡ç½®çš„å‰©ä½™æ—¶é—´
5. ä½¿ç”¨è¿›åº¦æ¡å’ŒçŠ¶æ€æŒ‡ç¤ºå™¨æ ¼å¼åŒ–è¾“å‡º
6. ç¼“å­˜ç»“æžœ60ç§’ï¼ˆå¯é…ç½®ï¼‰

## ç¼“å­˜

é»˜è®¤ç¼“å­˜ï¼š`/tmp/claude-usage-cache`ï¼ˆ60ç§’ TTLï¼‰

è¦†ç›–è®¾ç½®ï¼š
```bash
CACHE_FILE=/tmp/my-cache CACHE_TTL=300 ./scripts/claude-usage.sh
```

## ä½¿ç”¨ç¤ºä¾‹

**å¼€å§‹å·¥ä½œå‰æ£€æŸ¥ä½¿ç”¨é‡ï¼š**
```bash
./scripts/claude-usage.sh --fresh
```

**é›†æˆåˆ°çŠ¶æ€æ ï¼š**
```bash
usage=$(./scripts/claude-usage.sh | grep "Session" | awk '{print $NF}')
echo "ä¼šè¯: $usage"
```

**èŽ·å– JSON ç”¨äºŽç›‘æŽ§ï¼š**
```bash
./scripts/claude-usage.sh --json | jq '.session.utilization'
```

## è‡ªåŠ¨åŒ–ç›‘æŽ§

### ä¼šè¯åˆ·æ–°æé†’ï¼ˆæŽ¨èï¼‰

åœ¨æ‚¨çš„5å°æ—¶ä¼šè¯é…é¢åˆ·æ–°æ—¶èŽ·å–ç²¾ç¡®é€šçŸ¥ï¼

**å¿«é€Ÿè®¾ç½®ï¼š**
```bash
./scripts/session-reminder.sh
```

è¿™ä¼šåˆ›å»ºä¸€ä¸ª**è‡ªè°ƒåº¦çš„ cron ä½œä¸šé“¾**ï¼Œå…¶åŠŸèƒ½åŒ…æ‹¬ï¼š
1. æ£€æŸ¥æ‚¨å½“å‰çš„ä¼šè¯è¿‡æœŸæ—¶é—´
2. ä¸ºæ‚¨çš„ä¼šè¯åˆ·æ–°æ—¶é—´å®‰æŽ’ä¸‹ä¸€æ¬¡æé†’
3. ä½¿ç”¨å½“å‰ä½¿ç”¨æƒ…å†µç»Ÿè®¡é€šçŸ¥æ‚¨
4. è‡ªåŠ¨ç§»é™¤è‡ªèº«ï¼ˆç”±æ–°çš„ cron æŽ¥ç®¡ï¼‰

**æ‚¨å°†æ”¶åˆ°çš„å†…å®¹ï¼š**
```
ðŸ”„ Claude Code ä¼šè¯çŠ¶æ€

â±ï¸  å½“å‰ä½¿ç”¨é‡: 44%
â°  ä¸‹æ¬¡åˆ·æ–°: 2å°æ—¶ 15åˆ†é’Ÿ

æ‚¨çš„5å°æ—¶é…é¢å³å°†é‡ç½®ï¼ðŸ¦ž

âœ… ä¸‹æ¬¡æé†’å·²å®‰æŽ’: 1æœˆ22æ—¥ å‡Œæ™¨01:22
```

**å·¥ä½œåŽŸç†ï¼š**
- æ¯ä¸ªæé†’è¿è¡Œ `claude-usage.sh` æ¥æ‰¾åˆ°ç²¾ç¡®çš„ä¼šè¯é‡ç½®æ—¶é—´
- ä¸ºè¯¥ç²¾ç¡®æ—¶åˆ»å®‰æŽ’ä¸€æ¬¡æ€§çš„ cron
- æ¯5å°æ—¶è‡ªåŠ¨é‡å¤
- å¦‚æžœä¼šè¯æ—¶é—´æ¼‚ç§»ä¼šè‡ªåŠ¨çº æ­£

**ä¼˜åŠ¿ï¼š**
- âœ… ç²¾ç¡®åˆ°åˆ†é’Ÿ
- âœ… æ— éœ€æ‰‹åŠ¨è°ƒåº¦
- âœ… é€‚åº”æ‚¨çš„å®žé™…ä½¿ç”¨æ¨¡å¼
- âœ… æœ€å°åŒ– API è°ƒç”¨ï¼ˆä»…åœ¨éœ€è¦æ—¶ï¼‰

### é‡ç½®æ£€æµ‹ç›‘æŽ§ï¼ˆæ›¿ä»£æ–¹æ¡ˆï¼‰

é€šè¿‡è½®è¯¢ä½¿ç”¨æƒ…å†µåœ¨æ‚¨çš„ Claude Code é…é¢é‡ç½®æ—¶è‡ªåŠ¨èŽ·å–é€šçŸ¥ã€‚

**å¿«é€Ÿè®¾ç½®ï¼š**
```bash
# æµ‹è¯•ä¸€æ¬¡
./scripts/monitor-usage.sh

# è®¾ç½®è‡ªåŠ¨åŒ–ç›‘æŽ§ï¼ˆæ¯30åˆ†é’Ÿè¿è¡Œï¼‰
./scripts/setup-monitoring.sh
```

æˆ–ç›´æŽ¥é€šè¿‡ Clawdbot æ·»åŠ ï¼š
```bash
# æ¯30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
clawdbot cron add --cron "*/30 * * * *" \
  --message "cd /Users/ali/clawd/skills/claude-code-usage && ./scripts/monitor-usage.sh" \
  --name "Claude Code Usage Monitor" \
  --session isolated --deliver --channel telegram
```

**æ‚¨å°†æ”¶åˆ°çš„å†…å®¹ï¼š**
```
ðŸŽ‰ Claude Code ä¼šè¯å·²é‡ç½®ï¼

â±ï¸  æ‚¨çš„5å°æ—¶é…é¢å·²é‡ç½®
ðŸ“Š ä½¿ç”¨é‡: 2%
â° ä¸‹æ¬¡é‡ç½®: 4å°æ—¶ 58åˆ†é’Ÿ

æ–°çš„ä½¿ç”¨é‡å·²å¯ç”¨ï¼ðŸ¦ž
```

**å·¥ä½œåŽŸç†ï¼š**
1. **ç›‘æŽ§ä½¿ç”¨æƒ…å†µ** æ¯30åˆ†é’Ÿï¼ˆå¯é…ç½®ï¼‰
2. **æ£€æµ‹é‡ç½®** å½“ä½¿ç”¨é‡æ˜¾è‘—ä¸‹é™æ—¶ï¼ˆ>10% æˆ– <5%ï¼‰
3. **å‘é€é€šçŸ¥** é‡ç½®æ—¶é€šè¿‡ Telegram å‘é€
4. **è·Ÿè¸ªçŠ¶æ€** åœ¨ `/tmp/claude-usage-state.json` ä¸­

**è‡ªå®šä¹‰è®¾ç½®ï¼š**
```bash
# æ›´æ”¹æ£€æŸ¥é—´éš”
clawdbot cron add --cron "*/15 * * * *" ...  # æ¯15åˆ†é’Ÿ
clawdbot cron add --cron "0 * * * *" ...      # æ¯å°æ—¶

# è‡ªå®šä¹‰çŠ¶æ€æ–‡ä»¶ä½ç½®
STATE_FILE=/path/to/state.json ./scripts/monitor-usage.sh
```

### ç›‘æŽ§æ–¹æ³•å¯¹æ¯”

| åŠŸèƒ½ | ä¼šè¯æé†’ | é‡ç½®æ£€æµ‹ |
|------|---------|---------|
| ç²¾ç¡®åº¦ | âœ… ç²¾ç¡®åˆ°åˆ†é’Ÿ | ~30åˆ†é’Ÿçª—å£ |
| API è°ƒç”¨ | æœ€å°‘ | æ¯æ¬¡æ£€æŸ¥ |
| é€šçŸ¥æ—¶æœº | æ­£å¥½åœ¨é‡ç½®æ—¶ | æœ€å¤š30åˆ†é’Ÿå»¶è¿Ÿ |
| è®¾ç½® | ä¸€æ¡å‘½ä»¤ | ä¸€æ¡å‘½ä»¤ |
| ç»´æŠ¤ | è‡ªè°ƒåº¦ | Cron æ°¸ä¹…è¿è¡Œ |

**å»ºè®®ï¼š** ä½¿ç”¨**ä¼šè¯æé†’**ä»¥èŽ·å–ç²¾ç¡®çš„å®žæ—¶é€šçŸ¥ã€‚

## æ•…éšœæŽ’é™¤

**æ‰¾ä¸åˆ°å‡­æ®ï¼š**
- ç¡®ä¿å·²å®‰è£…å¹¶éªŒè¯ Claude Code CLI
- è¿è¡Œ `claude` ä¸€æ¬¡ä»¥è§¦å‘ OAuth æµç¨‹

**API è¯·æ±‚å¤±è´¥ï¼š**
- æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
- éªŒè¯ OAuth ä»¤ç‰Œæ˜¯å¦è¿‡æœŸ
- å°è¯• `--fresh` å¼ºåˆ¶æ–°è¯·æ±‚

**Linux ç”¨æˆ·ï¼š**
å®‰è£… `libsecret` ç”¨äºŽå‡­æ®å­˜å‚¨ï¼š
```bash
# Debian/Ubuntu
sudo apt install libsecret-tools

# Fedora/RHEL
sudo dnf install libsecret
```
