<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>订阅取消审核报告</title>
  <style>
    :root {
      --bg: #fff;
      --text: #222;
      --muted: #666;
      --border: #ddd;
      --accent: #1976d2;
      --pending: #fff3cd;
      --pending-border: #ffc107;
      --cancelled: #e8e8e8;
      --investigate: #f57c00;
      --keep: #388e3c;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #1a1a1a;
        --text: #e0e0e0;
        --muted: #999;
        --border: #333;
        --accent: #64b5f6;
        --pending: #3d3200;
        --pending-border: #ffc107;
        --cancelled: #2a2a2a;
        --investigate: #ffb74d;
        --keep: #81c784;
      }
    }
    body {
      max-width: 900px;
      margin: 40px auto;
      padding: 0 20px;
      font-family: system-ui;
      background: var(--bg);
      color: var(--text);
    }

    /* 分享卡片 - 收据风格 */
    .share-card {
      background: transparent;
      color: var(--text);
      padding: 1.5rem 0;
      margin: 0 0 2rem 0;
      text-align: left;
      border-bottom: 2px dashed var(--accent);
    }
    .share-card .scope {
      font-size: 0.875rem;
      color: var(--accent);
      margin-bottom: 0.75rem;
    }
    .share-card .breakdown {
      font-size: 1.1rem;
      color: var(--accent);
      margin-bottom: 0.5rem;
    }
    .share-card h1 {
      font-size: 2.75rem;
      font-weight: 800;
      margin: 0;
      letter-spacing: -1px;
      color: var(--text);
    }
    .share-card h1 span {
      font-size: 1.25rem;
      font-weight: 500;
      color: var(--muted);
    }
    .share-card .timestamp {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 1rem;
    }

    /* 页面元信息 */
    .page-meta {
      color: var(--muted);
      font-size: 0.875rem;
      margin-bottom: 2rem;
      text-align: center;
    }

    /* 部分区域 */
    .section { margin: 2rem 0; }
    .section.empty { display: none; }
    .section-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border);
      cursor: pointer;
    }
    .section-header::before {
      content: '\25BC';
      font-size: 0.6rem;
      color: var(--muted);
      transition: transform 0.2s;
    }
    .section.collapsed .section-header::before {
      transform: rotate(-90deg);
    }
    .section.collapsed table,
    .section.collapsed details {
      display: none;
    }
    .section-header h2 { margin: 0; font-size: 1.25rem; }
    .section-count {
      margin-left: auto;
      color: var(--muted);
      font-size: 0.875rem;
    }

    /* 徽章样式 */
    .badge {
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .badge-pending { background: var(--pending-border); color: #000; }
    .badge-cancelled { background: var(--keep); color: white; }
    .badge-investigate { background: var(--investigate); color: white; }
    .badge-keep { background: #666; color: white; }

    /* 表格样式 */
    table { border-collapse: collapse; width: 100%; }
    td, th { border: 1px solid var(--border); padding: 10px 12px; text-align: left; }
    th { background: var(--border); font-size: 0.85rem; }
    .amount { font-family: monospace; text-align: right; white-space: nowrap; }
    .note { font-size: 0.85rem; color: var(--muted); }
    .checkbox { width: 30px; text-align: center; }
    input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }

    /* 行状态样式 */
    tr.pending {
      background: var(--pending);
    }
    tr.pending td:first-child {
      border-left: 4px solid var(--pending-border);
    }
    tr.cancelled {
      background: var(--cancelled);
      color: var(--muted);
    }
    tr.cancelled td {
      text-decoration: line-through;
      text-decoration-color: var(--muted);
    }
    tr.cancelled .status-cell {
      text-decoration: none;
      font-style: italic;
    }
    tr.investigate td:first-child { border-left: 4px solid var(--investigate); }
    tr.keep td:first-child { border-left: 4px solid var(--keep); }

    /* 表格中的分类标题 */
    .category-header {
      background: var(--border);
      font-weight: bold;
      color: var(--muted);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .category-header td { border-left: none !important; }

    /* 详情/展开区域 */
    details { margin-top: 1rem; }
    summary { cursor: pointer; font-weight: 600; }
    summary:hover { color: var(--accent); }

    /* 隐私切换按钮 */
    .privacy-toggle {
      margin-left: 1rem;
      padding: 4px 10px;
      font-size: 0.75rem;
      background: var(--border);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: var(--muted);
    }
    .privacy-toggle:hover { background: var(--accent); color: white; }
    body.privacy-mode .service-name {
      filter: blur(5px);
      user-select: none;
    }
    body.privacy-mode .service-name:hover {
      filter: none;
    }

    /* 浮动复制按钮 */
    .floating-copy {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--text);
      color: var(--bg);
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: none;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    .floating-copy:hover { opacity: 0.9; }
    .floating-copy.visible { display: block; }
    .floating-copy.copied { background: var(--keep); }
  </style>
</head>
<body>

<!-- 分享卡片 - 分析完成后更新 -->
<div class="share-card">
  <p class="scope">发现 N 个订阅 · N 笔交易</p>
  <p class="breakdown">已取消 N · 保留 N</p>
  <h1>每年节省 $XX,XXX <span>（每月 $X,XXX）</span></h1>
  <p class="timestamp">运行时间: DATE at TIME</p>
</div>

<p class="page-meta">
  订阅审核
  <button class="privacy-toggle" onclick="togglePrivacy()">隐藏名称</button>
</p>

<!-- 已取消 - 完成，删除线 -->
<div class="section" id="section-cancelled">
  <div class="section-header" onclick="this.parentElement.classList.toggle('collapsed')">
    <span class="badge badge-cancelled">完成</span>
    <h2>已取消</h2>
    <span class="section-count" data-section="cancelled"></span>
  </div>
  <table>
    <tr>
      <th style="width:30px"></th>
      <th>服务</th>
      <th>每月</th>
      <th>状态</th>
    </tr>
    <!-- 模板: 已取消的项目
    <tr class="cancelled" data-status="cancelled">
      <td>✓</td>
      <td><strong class="service-name">服务名称</strong></td>
      <td class="amount">$XX</td>
      <td class="status-cell">已取消于 DATE</td>
    </tr>
    -->
  </table>
</div>

<!-- 调查中 - 需要决策 -->
<div class="section" id="section-investigate">
  <div class="section-header" onclick="this.parentElement.classList.toggle('collapsed')">
    <span class="badge badge-investigate">决策</span>
    <h2>需要决策</h2>
    <span class="section-count" data-section="investigate"></span>
  </div>
  <table>
    <tr>
      <th class="checkbox">取消?</th>
      <th>服务</th>
      <th>每月</th>
      <th>问题</th>
    </tr>
    <!-- 模板: 需要决策的项目
    <tr class="investigate" data-status="investigate">
      <td class="checkbox"><input type="checkbox"></td>
      <td><strong class="service-name">服务名称</strong></td>
      <td class="amount">$XX</td>
      <td class="note">为什么需要审核</td>
    </tr>
    -->
  </table>
</div>

<!-- 保留中 - 无需复选框 -->
<div class="section" id="section-keep">
  <div class="section-header" onclick="this.parentElement.classList.toggle('collapsed')">
    <span class="badge badge-keep">保留</span>
    <h2>保留</h2>
    <span class="section-count" data-section="keep"></span>
  </div>
  <table>
    <tr>
      <th>服务</th>
      <th>每月</th>
      <th>原因</th>
    </tr>
    <!-- 模板: 分类标题（可选）
    <tr class="category-header"><td colspan="3">分类名称</td></tr>
    -->
    <!-- 模板: 保留的项目
    <tr class="keep" data-status="keep">
      <td><strong class="service-name">服务名称</strong></td>
      <td class="amount">$XX</td>
      <td class="note">保留原因</td>
    </tr>
    -->
  </table>
</div>

<!-- 浮动复制按钮 -->
<button class="floating-copy" onclick="copyChecked()">复制已选</button>

<script>
/**
 * 切换隐私模式 - 模糊服务名称
 */
function togglePrivacy() {
  document.body.classList.toggle('privacy-mode');
  const btn = document.querySelector('.privacy-toggle');
  btn.textContent = document.body.classList.contains('privacy-mode') ? '显示名称' : '隐藏名称';
}

/**
 * 更新各部分的项目数量统计
 */
function updateCounts() {
  document.querySelectorAll('[data-section]').forEach(el => {
    const section = el.dataset.section;
    const count = document.querySelectorAll(`[data-status="${section}"]`).length;
    el.textContent = count > 0 ? `${count} 项` : '';
  });
}

/**
 * 更新浮动按钮的可见性和文本
 */
function updateFloatingButton() {
  const checked = document.querySelectorAll('input[type="checkbox"]:checked');
  const btn = document.querySelector('.floating-copy');
  btn.classList.toggle('visible', checked.length > 0);
  btn.textContent = checked.length > 0 ? `复制 ${checked.length} 项已选` : '复制已选';
}

/**
 * 复制选中的项目到剪贴板
 */
function copyChecked() {
  const checked = document.querySelectorAll('input[type="checkbox"]:checked');
  const items = [];
  checked.forEach(cb => {
    const row = cb.closest('tr');
    const name = row.querySelector('.service-name')?.textContent || '';
    const amount = row.querySelector('.amount')?.textContent || '';
    if (name) items.push(`${name} (${amount})`);
  });

  const text = `取消这些: ${items.join(', ')}`;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.querySelector('.floating-copy');
    btn.classList.add('copied');
    btn.textContent = '已复制!';
    setTimeout(() => {
      btn.classList.remove('copied');
      updateFloatingButton();
    }, 1500);
  });
}

// 复选框变更事件处理
document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
  cb.addEventListener('change', function() {
    const row = this.closest('tr');
    if (this.checked) {
      row.classList.add('pending');
      row.dataset.status = 'pending';
    } else {
      row.classList.remove('pending');
      const section = row.closest('.section').id.replace('section-', '');
      row.dataset.status = section;
    }
    updateCounts();
    updateFloatingButton();
    hideEmptySections();
  });
});

/**
 * 隐藏空的部分区域
 */
function hideEmptySections() {
  document.querySelectorAll('.section').forEach(section => {
    const rows = section.querySelectorAll('tr[data-status]');
    section.classList.toggle('empty', rows.length === 0);
  });
}

// 初始化执行
updateCounts();
updateFloatingButton();
hideEmptySections();
</script>
</body>
</html>
